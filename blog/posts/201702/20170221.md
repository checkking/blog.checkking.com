<!--
author: checkking
date: 2017-02-21
title: nginx学习笔记（二）
tags: nginx
category: nginx
status: publish
summary: 总结一下nginx基础架构
-->
#### 事件驱动架构
`Nginx`采用完全的事件驱动架构来处理业务，这与传统的web服务器(如apache)是不同的。对于传统的web服务器而言，
采用所谓的时间驱动往往局限在TCP连接建立、关闭事件上，一个连接建立以后，在其关闭之前的所有操作都不再是
事件驱动，这是会退化成按序执行每个操作的批处理模式，这样每个请求在连接建立以后都始终占用这系统资源，直到
连接关闭才会释放资源。
要知道，这段时间可能会非常长，从1ms到1min都有可能，而且这段时间内占用这内存、CPU等资源也许没有意义，整个
事件消费进程只是等待某个条件而已，造成了服务器资源的极大浪费，影响了系统可以处理的并发连接数。

Nginx则不然，它不会使用进程或线程来作为事件消费者，所谓的事件消费者只能是某个模块（在这里没有进程的概念）。只有
事件收集、分发器才有资格占用系统进程资源，他们会在分发某个事件时调用时间消费模块使用当前进程资源。如图所示。
图中列出了5个不同的事件，在事件收集、分发者进程的一次处理过程中，这5个事件按照顺序被收集后，将开始使用当前进程分发事件，
从而调用相应的事件消费模块来处理事件。当然，这种分发、调用也是有序的。

从上面的内容可以开出传统web服务器与Nginx的重要差别：前者是每个事件消费者独占一个进程资源，后者的事件消费者只是被事件
分发者进程短暂调用而已。这种设计使得网络性能、用户感知的请求时延都得到提升，每个用户的请求所产生的事件会及时响应，整个
服务器的网络吞吐量都会由于事件的及时响应而增大。但是，这要求每个事件消费者都不能有阻塞行为，否则将会由于长时间占用
事件分发者进程而导致其他事件得不到及时响应。

#### 请求的多阶段异步处理
