<!--
author: checkking
date: 2017-03-19
title: Google Protobuffer "Base 128 Varints"编码
tags: protobuffer
category: protobuffer
status: publish
summary: Google Protobuffer编码笔记
-->
### Base 128 Varints
官方描述：Each byte in a varint, except the last byte, has the most significant bit (msb) set – this indicates that there are further bytes to come. The lower 7 bits of each byte are used to store the two's complement representation of the number in groups of 7 bits, **least significant group first**.
也就是：

1. 除了最后一个字节，varint中的每个字节的最高位设为1，表示后面还有字节出现
2. 每个字节的低7位看成是一个组（group），这个组和他相邻的下一个7位组共同存储某个整形的“组合表示”，最低有效组在前面。

例子：
1. 一个字节。下面只有一个字节，所以最高位是0，表示十进制1
```bash
0000 0001
```

2. 两个字节
```bash
1010 1100 0000 0010
```
由于第一个字节后面还有一个字节，所以第一个字节的最高位设置为1，表示后面还有后继字节，第二个字节的最高位为0。去掉每个字节的最高位，我们对两个字节进行分组。第一个7位组：0101100，第二个7位组：0000010，组合起来就是：0101100 0000010。
由于protobuffer采用小端字节序([关于字节序](https://en.wikipedia.org/wiki/Endianness))，也就是数据的低位保存在内存的低地址中，调整为`0101100 0000010`, 十进制为`2^8 + 2^5 + 2^3 + 2^2 = 300`


